<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logger æµè§ˆå™¨ä½¿ç”¨ç¤ºä¾‹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fafafa;
        }
        .demo-section h3 {
            color: #555;
            margin-top: 0;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        button {
            background-color: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #005a9e;
        }
        .console-output {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        .info { color: #4fc3f7; }
        .warn { color: #ffb74d; }
        .error { color: #f44336; }
        .debug { color: #81c784; }
        .clear-btn {
            background-color: #666;
            margin-top: 10px;
        }
        .clear-btn:hover {
            background-color: #444;
        }
        code {
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Logger æ¨¡å—æµè§ˆå™¨ç¤ºä¾‹</h1>
        
        <div class="demo-section">
            <h3>ğŸ“ åŸºæœ¬æ—¥å¿—è®°å½•</h3>
            <p>æ¼”ç¤ºä¸åŒçº§åˆ«çš„æ—¥å¿—è¾“å‡ºï¼š</p>
            <button onclick="basicLogging()">åŸºæœ¬æ—¥å¿—</button>
            <button onclick="logWithData()">å¸¦æ•°æ®æ—¥å¿—</button>
            <button onclick="logLevels()">æ‰€æœ‰çº§åˆ«</button>
        </div>

        <div class="demo-section">
            <h3>ğŸ› Error å¯¹è±¡å¤„ç†</h3>
            <p>å±•ç¤º Error å¯¹è±¡çš„è‡ªåŠ¨åºåˆ—åŒ–åŠŸèƒ½ï¼š</p>
            <button onclick="simpleError()">ç®€å•é”™è¯¯</button>
            <button onclick="nestedError()">åµŒå¥—é”™è¯¯</button>
            <button onclick="errorWithContext()">é”™è¯¯+ä¸Šä¸‹æ–‡</button>
        </div>

        <div class="demo-section">
            <h3>ğŸ”— å­æ—¥å¿—è®°å½•å™¨</h3>
            <p>æ¼”ç¤ºä¸Šä¸‹æ–‡ç»§æ‰¿å’Œåˆå¹¶ï¼š</p>
            <button onclick="parentChild()">çˆ¶å­æ—¥å¿—å™¨</button>
            <button onclick="deepNesting()">æ·±å±‚åµŒå¥—</button>
            <button onclick="contextOverride()">ä¸Šä¸‹æ–‡è¦†ç›–</button>
        </div>

        <div class="demo-section">
            <h3>ğŸ¨ è‡ªå®šä¹‰æ ¼å¼åŒ–</h3>
            <p>å±•ç¤ºè‡ªå®šä¹‰æ ¼å¼åŒ–å™¨çš„ä½¿ç”¨ï¼š</p>
            <button onclick="customFormatter()">è‡ªå®šä¹‰æ ¼å¼</button>
            <button onclick="simpleFormatter()">ç®€å•æ ¼å¼</button>
        </div>

        <div class="demo-section">
            <h3>ğŸ¯ å®é™…åº”ç”¨åœºæ™¯</h3>
            <p>æ¨¡æ‹ŸçœŸå®åº”ç”¨ä¸­çš„æ—¥å¿—è®°å½•ï¼š</p>
            <button onclick="webAppScenario()">Webåº”ç”¨åœºæ™¯</button>
            <button onclick="userActionScenario()">ç”¨æˆ·æ“ä½œåœºæ™¯</button>
            <button onclick="apiRequestScenario()">APIè¯·æ±‚åœºæ™¯</button>
        </div>

        <div class="console-output" id="output">æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ¼”ç¤ºï¼</div>
        <button class="clear-btn" onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
    </div>

    <!-- è¿™é‡Œåº”è¯¥å¼•å…¥å®é™…çš„ jsutils åº“ -->
    <!-- <script src="path/to/jsutils.js"></script> -->
    
    <!-- ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿ logger åŠŸèƒ½ -->
    <script>
        // æ¨¡æ‹Ÿ jsutils logger åŠŸèƒ½ï¼ˆå®é™…ä½¿ç”¨æ—¶åº”è¯¥å¯¼å…¥çœŸå®çš„åº“ï¼‰
        function createLogger(options) {
            return {
                options,
                log: function(message, ...params) { this._log('log', message, ...params); },
                info: function(message, ...params) { this._log('info', message, ...params); },
                warn: function(message, ...params) { this._log('warn', message, ...params); },
                error: function(message, ...params) { this._log('error', message, ...params); },
                debug: function(message, ...params) { this._log('debug', message, ...params); },
                
                _log: function(level, message, ...params) {
                    if (this.options.formatter) {
                        const formatted = this.options.formatter(level, message, ...params);
                        appendOutput(formatted, level);
                    } else {
                        const processedMessage = this._processErrorObject(message);
                        const logData = {
                            ...this.options.context,
                            level,
                            message: processedMessage,
                            timestamp: new Date().toISOString(),
                            ...(params.length > 0 && { context: params.map(p => this._processErrorObject(p)) })
                        };
                        appendOutput(JSON.stringify(logData, null, 2), level);
                    }
                },
                
                _processErrorObject: function(value) {
                    if (value instanceof Error) {
                        const errorInfo = {
                            message: value.message,
                            stack: value.stack,
                            name: value.name
                        };
                        if (value.cause) {
                            errorInfo.cause = this._processErrorObject(value.cause);
                        }
                        return errorInfo;
                    }
                    return value;
                },
                
                child: function(context, options = {}) {
                    const newOptions = {
                        ...this.options,
                        ...options,
                        context: {
                            ...this.options.context,
                            ...context
                        }
                    };
                    return createLogger(newOptions);
                }
            };
        }

        function appendOutput(text, level = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const levelClass = level === 'error' ? 'error' : level === 'warn' ? 'warn' : level === 'debug' ? 'debug' : 'info';
            output.innerHTML += `<span class="${levelClass}">[${timestamp}] ${text}</span>\n\n`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = 'æ§åˆ¶å°å·²æ¸…ç©ºï¼Œå‡†å¤‡æ–°çš„æ¼”ç¤º...\n';
        }

        // æ¼”ç¤ºå‡½æ•°
        function basicLogging() {
            appendOutput('=== åŸºæœ¬æ—¥å¿—è®°å½•æ¼”ç¤º ===', 'info');
            const logger = createLogger({ name: 'BasicApp', level: 'info' });
            
            logger.info('åº”ç”¨å¯åŠ¨æˆåŠŸ');
            logger.warn('è¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¶ˆæ¯');
            logger.error('è¿™æ˜¯ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯');
        }

        function logWithData() {
            appendOutput('=== å¸¦æ•°æ®çš„æ—¥å¿—è®°å½• ===', 'info');
            const logger = createLogger({ name: 'DataApp', level: 'info' });
            
            logger.info('ç”¨æˆ·ç™»å½•', { userId: 123, username: 'john_doe' });
            logger.warn('æ€§èƒ½è­¦å‘Š', { responseTime: 2500, threshold: 2000 });
        }

        function logLevels() {
            appendOutput('=== æ‰€æœ‰æ—¥å¿—çº§åˆ«æ¼”ç¤º ===', 'info');
            const logger = createLogger({ name: 'LevelApp', level: 'debug' });
            
            logger.debug('è°ƒè¯•ä¿¡æ¯ï¼šå˜é‡å€¼æ£€æŸ¥');
            logger.info('ä¿¡æ¯ï¼šæ“ä½œå®Œæˆ');
            logger.warn('è­¦å‘Šï¼šèµ„æºä½¿ç”¨ç‡é«˜');
            logger.error('é”™è¯¯ï¼šæ“ä½œå¤±è´¥');
        }

        function simpleError() {
            appendOutput('=== ç®€å•é”™è¯¯å¤„ç† ===', 'info');
            const logger = createLogger({ name: 'ErrorApp', level: 'info' });
            
            try {
                throw new Error('æ•°æ®åº“è¿æ¥å¤±è´¥');
            } catch (error) {
                logger.error('æ•è·åˆ°é”™è¯¯', error);
            }
        }

        function nestedError() {
            appendOutput('=== åµŒå¥—é”™è¯¯å¤„ç† ===', 'info');
            const logger = createLogger({ name: 'NestedErrorApp', level: 'info' });
            
            try {
                const cause = new Error('ç½‘ç»œè¶…æ—¶');
                throw new Error('è¯·æ±‚å¤±è´¥', { cause });
            } catch (error) {
                logger.error('åµŒå¥—é”™è¯¯', error);
            }
        }

        function errorWithContext() {
            appendOutput('=== é”™è¯¯+ä¸Šä¸‹æ–‡ä¿¡æ¯ ===', 'info');
            const logger = createLogger({ name: 'ContextErrorApp', level: 'info' });
            
            try {
                throw new Error('æ”¯ä»˜å¤„ç†å¤±è´¥');
            } catch (error) {
                logger.error('æ”¯ä»˜é”™è¯¯', error, { 
                    orderId: 'ORD-12345', 
                    amount: 99.99, 
                    paymentMethod: 'credit_card' 
                });
            }
        }

        function parentChild() {
            appendOutput('=== çˆ¶å­æ—¥å¿—è®°å½•å™¨ ===', 'info');
            const parentLogger = createLogger({
                name: 'ParentApp',
                level: 'info',
                context: { service: 'web-server', version: '1.0.0' }
            });
            
            const childLogger = parentLogger.child({ module: 'user-service', userId: 12345 });
            
            parentLogger.info('çˆ¶çº§æ—¥å¿—æ¶ˆæ¯');
            childLogger.info('å­çº§æ—¥å¿—æ¶ˆæ¯');
        }

        function deepNesting() {
            appendOutput('=== æ·±å±‚åµŒå¥—æ—¥å¿—è®°å½•å™¨ ===', 'info');
            const appLogger = createLogger({
                name: 'App',
                level: 'info',
                context: { env: 'production' }
            });
            
            const moduleLogger = appLogger.child({ module: 'auth' });
            const requestLogger = moduleLogger.child({ requestId: 'req-abc123' });
            
            appLogger.info('åº”ç”¨çº§åˆ«æ¶ˆæ¯');
            moduleLogger.info('æ¨¡å—çº§åˆ«æ¶ˆæ¯');
            requestLogger.info('è¯·æ±‚çº§åˆ«æ¶ˆæ¯');
        }

        function contextOverride() {
            appendOutput('=== ä¸Šä¸‹æ–‡è¦†ç›–æ¼”ç¤º ===', 'info');
            const logger = createLogger({
                name: 'OverrideApp',
                level: 'info',
                context: { env: 'dev', version: '1.0.0' }
            });
            
            const childLogger = logger.child({ env: 'production', module: 'api' });
            
            logger.info('çˆ¶çº§ä¸Šä¸‹æ–‡');
            childLogger.info('å­çº§è¦†ç›–ä¸Šä¸‹æ–‡');
        }

        function customFormatter() {
            appendOutput('=== è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨ ===', 'info');
            const logger = createLogger({
                name: 'CustomApp',
                level: 'info',
                formatter: (level, message, ...params) => {
                    const timestamp = new Date().toLocaleTimeString();
                    return `[${timestamp}] ${level.toUpperCase()}: ${message} ${params.length > 0 ? JSON.stringify(params) : ''}`;
                }
            });
            
            logger.info('è‡ªå®šä¹‰æ ¼å¼çš„æ¶ˆæ¯', { extra: 'data' });
            logger.warn('è‡ªå®šä¹‰æ ¼å¼çš„è­¦å‘Š');
        }

        function simpleFormatter() {
            appendOutput('=== ç®€å•æ ¼å¼åŒ–å™¨ ===', 'info');
            const logger = createLogger({
                name: 'SimpleApp',
                level: 'info',
                formatter: (level, message) => `${level}: ${message}`
            });
            
            logger.info('ç®€å•æ ¼å¼æ¶ˆæ¯');
            logger.error('ç®€å•æ ¼å¼é”™è¯¯');
        }

        function webAppScenario() {
            appendOutput('=== Webåº”ç”¨åœºæ™¯æ¼”ç¤º ===', 'info');
            const appLogger = createLogger({
                name: 'WebApp',
                level: 'info',
                context: { env: 'production', version: '2.1.0' }
            });
            
            const authLogger = appLogger.child({ module: 'auth' });
            const dbLogger = appLogger.child({ module: 'database' });
            
            authLogger.info('ç”¨æˆ·è®¤è¯å¼€å§‹', { username: 'alice' });
            dbLogger.debug('æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢', { table: 'users', query: 'SELECT * FROM users WHERE id = ?' });
            authLogger.info('ç”¨æˆ·è®¤è¯æˆåŠŸ', { userId: 456, role: 'admin' });
        }

        function userActionScenario() {
            appendOutput('=== ç”¨æˆ·æ“ä½œåœºæ™¯ ===', 'info');
            const logger = createLogger({
                name: 'UserTracker',
                level: 'info',
                context: { sessionId: 'sess-xyz789' }
            });
            
            const userLogger = logger.child({ userId: 789, username: 'bob' });
            
            userLogger.info('ç”¨æˆ·è®¿é—®é¡µé¢', { page: '/dashboard', referrer: '/login' });
            userLogger.info('ç”¨æˆ·ç‚¹å‡»æŒ‰é’®', { button: 'export-data', timestamp: Date.now() });
            userLogger.warn('ç”¨æˆ·æ“ä½œé¢‘ç‡è¿‡é«˜', { actionCount: 15, timeWindow: '1min' });
        }

        function apiRequestScenario() {
            appendOutput('=== APIè¯·æ±‚åœºæ™¯ ===', 'info');
            const apiLogger = createLogger({
                name: 'APIServer',
                level: 'info',
                context: { service: 'user-api', version: '1.5.2' }
            });
            
            const requestLogger = apiLogger.child({
                requestId: 'req-def456',
                method: 'POST',
                path: '/api/users',
                clientIp: '192.168.1.100'
            });
            
            requestLogger.info('æ¥æ”¶åˆ°APIè¯·æ±‚');
            requestLogger.debug('éªŒè¯è¯·æ±‚å‚æ•°', { bodySize: 1024, contentType: 'application/json' });
            requestLogger.info('è¯·æ±‚å¤„ç†å®Œæˆ', { statusCode: 201, responseTime: 145 });
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.onload = function() {
            appendOutput('ğŸ‰ Logger æ¼”ç¤ºé¡µé¢å·²åŠ è½½å®Œæˆï¼', 'info');
            appendOutput('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ä½“éªŒä¸åŒçš„æ—¥å¿—åŠŸèƒ½...', 'info');
        };
    </script>
</body>
</html>