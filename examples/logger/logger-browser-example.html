<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logger 浏览器使用示例</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fafafa;
        }
        .demo-section h3 {
            color: #555;
            margin-top: 0;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        button {
            background-color: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #005a9e;
        }
        .console-output {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        .info { color: #4fc3f7; }
        .warn { color: #ffb74d; }
        .error { color: #f44336; }
        .debug { color: #81c784; }
        .clear-btn {
            background-color: #666;
            margin-top: 10px;
        }
        .clear-btn:hover {
            background-color: #444;
        }
        code {
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 Logger 模块浏览器示例</h1>
        
        <div class="demo-section">
            <h3>📝 基本日志记录</h3>
            <p>演示不同级别的日志输出：</p>
            <button onclick="basicLogging()">基本日志</button>
            <button onclick="logWithData()">带数据日志</button>
            <button onclick="logLevels()">所有级别</button>
        </div>

        <div class="demo-section">
            <h3>🐛 Error 对象处理</h3>
            <p>展示 Error 对象的自动序列化功能：</p>
            <button onclick="simpleError()">简单错误</button>
            <button onclick="nestedError()">嵌套错误</button>
            <button onclick="errorWithContext()">错误+上下文</button>
        </div>

        <div class="demo-section">
            <h3>🔗 子日志记录器</h3>
            <p>演示上下文继承和合并：</p>
            <button onclick="parentChild()">父子日志器</button>
            <button onclick="deepNesting()">深层嵌套</button>
            <button onclick="contextOverride()">上下文覆盖</button>
        </div>

        <div class="demo-section">
            <h3>🎨 自定义格式化</h3>
            <p>展示自定义格式化器的使用：</p>
            <button onclick="customFormatter()">自定义格式</button>
            <button onclick="simpleFormatter()">简单格式</button>
        </div>

        <div class="demo-section">
            <h3>🎯 实际应用场景</h3>
            <p>模拟真实应用中的日志记录：</p>
            <button onclick="webAppScenario()">Web应用场景</button>
            <button onclick="userActionScenario()">用户操作场景</button>
            <button onclick="apiRequestScenario()">API请求场景</button>
        </div>

        <div class="console-output" id="output">控制台输出将显示在这里...
点击上方按钮开始演示！</div>
        <button class="clear-btn" onclick="clearOutput()">清空输出</button>
    </div>

    <!-- 这里应该引入实际的 jsutils 库 -->
    <!-- <script src="path/to/jsutils.js"></script> -->
    
    <!-- 为了演示，我们模拟 logger 功能 -->
    <script>
        // 模拟 jsutils logger 功能（实际使用时应该导入真实的库）
        function createLogger(options) {
            return {
                options,
                log: function(message, ...params) { this._log('log', message, ...params); },
                info: function(message, ...params) { this._log('info', message, ...params); },
                warn: function(message, ...params) { this._log('warn', message, ...params); },
                error: function(message, ...params) { this._log('error', message, ...params); },
                debug: function(message, ...params) { this._log('debug', message, ...params); },
                
                _log: function(level, message, ...params) {
                    if (this.options.formatter) {
                        const formatted = this.options.formatter(level, message, ...params);
                        appendOutput(formatted, level);
                    } else {
                        const processedMessage = this._processErrorObject(message);
                        const logData = {
                            ...this.options.context,
                            level,
                            message: processedMessage,
                            timestamp: new Date().toISOString(),
                            ...(params.length > 0 && { context: params.map(p => this._processErrorObject(p)) })
                        };
                        appendOutput(JSON.stringify(logData, null, 2), level);
                    }
                },
                
                _processErrorObject: function(value) {
                    if (value instanceof Error) {
                        const errorInfo = {
                            message: value.message,
                            stack: value.stack,
                            name: value.name
                        };
                        if (value.cause) {
                            errorInfo.cause = this._processErrorObject(value.cause);
                        }
                        return errorInfo;
                    }
                    return value;
                },
                
                child: function(context, options = {}) {
                    const newOptions = {
                        ...this.options,
                        ...options,
                        context: {
                            ...this.options.context,
                            ...context
                        }
                    };
                    return createLogger(newOptions);
                }
            };
        }

        function appendOutput(text, level = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const levelClass = level === 'error' ? 'error' : level === 'warn' ? 'warn' : level === 'debug' ? 'debug' : 'info';
            output.innerHTML += `<span class="${levelClass}">[${timestamp}] ${text}</span>\n\n`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '控制台已清空，准备新的演示...\n';
        }

        // 演示函数
        function basicLogging() {
            appendOutput('=== 基本日志记录演示 ===', 'info');
            const logger = createLogger({ name: 'BasicApp', level: 'info' });
            
            logger.info('应用启动成功');
            logger.warn('这是一个警告消息');
            logger.error('这是一个错误消息');
        }

        function logWithData() {
            appendOutput('=== 带数据的日志记录 ===', 'info');
            const logger = createLogger({ name: 'DataApp', level: 'info' });
            
            logger.info('用户登录', { userId: 123, username: 'john_doe' });
            logger.warn('性能警告', { responseTime: 2500, threshold: 2000 });
        }

        function logLevels() {
            appendOutput('=== 所有日志级别演示 ===', 'info');
            const logger = createLogger({ name: 'LevelApp', level: 'debug' });
            
            logger.debug('调试信息：变量值检查');
            logger.info('信息：操作完成');
            logger.warn('警告：资源使用率高');
            logger.error('错误：操作失败');
        }

        function simpleError() {
            appendOutput('=== 简单错误处理 ===', 'info');
            const logger = createLogger({ name: 'ErrorApp', level: 'info' });
            
            try {
                throw new Error('数据库连接失败');
            } catch (error) {
                logger.error('捕获到错误', error);
            }
        }

        function nestedError() {
            appendOutput('=== 嵌套错误处理 ===', 'info');
            const logger = createLogger({ name: 'NestedErrorApp', level: 'info' });
            
            try {
                const cause = new Error('网络超时');
                throw new Error('请求失败', { cause });
            } catch (error) {
                logger.error('嵌套错误', error);
            }
        }

        function errorWithContext() {
            appendOutput('=== 错误+上下文信息 ===', 'info');
            const logger = createLogger({ name: 'ContextErrorApp', level: 'info' });
            
            try {
                throw new Error('支付处理失败');
            } catch (error) {
                logger.error('支付错误', error, { 
                    orderId: 'ORD-12345', 
                    amount: 99.99, 
                    paymentMethod: 'credit_card' 
                });
            }
        }

        function parentChild() {
            appendOutput('=== 父子日志记录器 ===', 'info');
            const parentLogger = createLogger({
                name: 'ParentApp',
                level: 'info',
                context: { service: 'web-server', version: '1.0.0' }
            });
            
            const childLogger = parentLogger.child({ module: 'user-service', userId: 12345 });
            
            parentLogger.info('父级日志消息');
            childLogger.info('子级日志消息');
        }

        function deepNesting() {
            appendOutput('=== 深层嵌套日志记录器 ===', 'info');
            const appLogger = createLogger({
                name: 'App',
                level: 'info',
                context: { env: 'production' }
            });
            
            const moduleLogger = appLogger.child({ module: 'auth' });
            const requestLogger = moduleLogger.child({ requestId: 'req-abc123' });
            
            appLogger.info('应用级别消息');
            moduleLogger.info('模块级别消息');
            requestLogger.info('请求级别消息');
        }

        function contextOverride() {
            appendOutput('=== 上下文覆盖演示 ===', 'info');
            const logger = createLogger({
                name: 'OverrideApp',
                level: 'info',
                context: { env: 'dev', version: '1.0.0' }
            });
            
            const childLogger = logger.child({ env: 'production', module: 'api' });
            
            logger.info('父级上下文');
            childLogger.info('子级覆盖上下文');
        }

        function customFormatter() {
            appendOutput('=== 自定义格式化器 ===', 'info');
            const logger = createLogger({
                name: 'CustomApp',
                level: 'info',
                formatter: (level, message, ...params) => {
                    const timestamp = new Date().toLocaleTimeString();
                    return `[${timestamp}] ${level.toUpperCase()}: ${message} ${params.length > 0 ? JSON.stringify(params) : ''}`;
                }
            });
            
            logger.info('自定义格式的消息', { extra: 'data' });
            logger.warn('自定义格式的警告');
        }

        function simpleFormatter() {
            appendOutput('=== 简单格式化器 ===', 'info');
            const logger = createLogger({
                name: 'SimpleApp',
                level: 'info',
                formatter: (level, message) => `${level}: ${message}`
            });
            
            logger.info('简单格式消息');
            logger.error('简单格式错误');
        }

        function webAppScenario() {
            appendOutput('=== Web应用场景演示 ===', 'info');
            const appLogger = createLogger({
                name: 'WebApp',
                level: 'info',
                context: { env: 'production', version: '2.1.0' }
            });
            
            const authLogger = appLogger.child({ module: 'auth' });
            const dbLogger = appLogger.child({ module: 'database' });
            
            authLogger.info('用户认证开始', { username: 'alice' });
            dbLogger.debug('执行数据库查询', { table: 'users', query: 'SELECT * FROM users WHERE id = ?' });
            authLogger.info('用户认证成功', { userId: 456, role: 'admin' });
        }

        function userActionScenario() {
            appendOutput('=== 用户操作场景 ===', 'info');
            const logger = createLogger({
                name: 'UserTracker',
                level: 'info',
                context: { sessionId: 'sess-xyz789' }
            });
            
            const userLogger = logger.child({ userId: 789, username: 'bob' });
            
            userLogger.info('用户访问页面', { page: '/dashboard', referrer: '/login' });
            userLogger.info('用户点击按钮', { button: 'export-data', timestamp: Date.now() });
            userLogger.warn('用户操作频率过高', { actionCount: 15, timeWindow: '1min' });
        }

        function apiRequestScenario() {
            appendOutput('=== API请求场景 ===', 'info');
            const apiLogger = createLogger({
                name: 'APIServer',
                level: 'info',
                context: { service: 'user-api', version: '1.5.2' }
            });
            
            const requestLogger = apiLogger.child({
                requestId: 'req-def456',
                method: 'POST',
                path: '/api/users',
                clientIp: '192.168.1.100'
            });
            
            requestLogger.info('接收到API请求');
            requestLogger.debug('验证请求参数', { bodySize: 1024, contentType: 'application/json' });
            requestLogger.info('请求处理完成', { statusCode: 201, responseTime: 145 });
        }

        // 页面加载完成后的初始化
        window.onload = function() {
            appendOutput('🎉 Logger 演示页面已加载完成！', 'info');
            appendOutput('点击上方按钮体验不同的日志功能...', 'info');
        };
    </script>
</body>
</html>